eff Async
  await(tail) -> i32
  log(resume, msg: i32) -> i32

fn worker(): Async -> i32
  let value = Async::await()
  Async::log(value)
  value + 1

pub fn main(): () -> i32
  try
    worker()
  Async::await(tail):
    tail(2)
  Async::log(resume, msg):
    resume(msg)

pub fn double_resume(): () -> i32
  try
    worker()
  Async::await(tail):
    tail(3)
  Async::log(resume, msg):
    resume(msg)
    resume(msg + 1)

pub fn missing_tail(): () -> i32
  try
    worker()
  Async::await(tail):
    if 1 == 0 then:
      tail(1)
    else:
      0
  Async::log(resume, msg):
    resume(msg)

pub fn perform_in_try(): () -> i32
  try
    let value = Async::await()
    Async::log(value)
    value + 10
  Async::await(tail):
    tail(5)
  Async::log(resume, msg):
    resume(msg)

pub fn lambda_perform(): () -> i32
  try
    let f = () -> i32 =>
      let value = Async::await()
      value + 4
    f() + 1
  Async::await(tail):
    tail(20)
  Async::log(resume, msg):
    resume(msg)
