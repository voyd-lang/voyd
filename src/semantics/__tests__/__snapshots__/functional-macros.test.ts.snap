// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`functional macro expansion 1`] = `
[
  "module",
  "root",
  [
    "exports",
    [
      "std#902",
    ],
  ],
  [
    [
      "module",
      "std",
      [
        "exports",
        [],
      ],
      [
        [
          "use",
          [
            "::",
            "root",
            "all",
          ],
        ],
      ],
    ],
    [
      "module",
      "test",
      [
        "exports",
        [],
      ],
      [
        [
          "use",
          [
            "::",
            "root",
            "all",
          ],
        ],
        [
          "functional-macro",
          "\`#931",
          [
            "parameters",
          ],
          [
            "block",
            [
              "block",
              [
                "quote",
                "quote",
                [
                  "$@",
                  "body",
                ],
              ],
            ],
          ],
        ],
        [
          "functional-macro",
          "let#978",
          [
            "parameters",
          ],
          [
            "block",
            [
              "block",
              [
                "define",
                "equals_expr",
                [
                  "extract",
                  "body",
                  0,
                ],
              ],
              [
                "quote",
                "define",
                [
                  "$",
                  [
                    "extract",
                    "equals_expr",
                    1,
                  ],
                ],
                [
                  "$",
                  [
                    "extract",
                    "equals_expr",
                    2,
                  ],
                ],
              ],
            ],
          ],
        ],
        [
          "define-macro-variable",
          "extract_parameters",
          [
            "reserved-for-type",
          ],
          [
            "is-mutable",
            false,
          ],
        ],
        [
          "functional-macro",
          "fn#1771",
          [
            "parameters",
          ],
          [
            "block",
            [
              "block",
              [
                "define",
                "first",
                [
                  "extract",
                  "body",
                  0,
                ],
              ],
              [
                "define",
                "is_equals",
                [
                  "==",
                  [
                    "extract",
                    "first",
                    0,
                  ],
                  "=",
                ],
              ],
              [
                "define",
                "definitions",
                [
                  "block",
                  [
                    "if",
                    "is_equals",
                    [
                      ":",
                      "then",
                      [
                        "block",
                        [
                          "extract",
                          "first",
                          1,
                        ],
                      ],
                    ],
                    [
                      ":",
                      "else",
                      [
                        "block",
                        "first",
                      ],
                    ],
                  ],
                ],
              ],
              [
                "define",
                "identifier_list",
                [
                  "block",
                  [
                    "if",
                    [
                      "==",
                      [
                        "extract",
                        "definitions",
                        0,
                      ],
                      ":",
                    ],
                    [
                      ":",
                      "then",
                      [
                        "block",
                        [
                          "extract",
                          "definitions",
                          1,
                        ],
                      ],
                    ],
                    [
                      ":",
                      "else",
                      [
                        "block",
                        [
                          "if",
                          [
                            "==",
                            [
                              "extract",
                              "definitions",
                              0,
                            ],
                            "->",
                          ],
                          [
                            ":",
                            "then",
                            [
                              "block",
                              [
                                "extract",
                                "definitions",
                                1,
                              ],
                            ],
                          ],
                          [
                            ":",
                            "else",
                            [
                              "block",
                              "definitions",
                            ],
                          ],
                        ],
                      ],
                    ],
                  ],
                ],
              ],
              [
                "define",
                "return_type",
                [
                  "block",
                  [
                    "if",
                    [
                      "==",
                      [
                        "extract",
                        "definitions",
                        0,
                      ],
                      ":",
                    ],
                    [
                      ":",
                      "then",
                      [
                        "block",
                        [
                          "slice",
                          "definitions",
                          2,
                          3,
                        ],
                      ],
                    ],
                    [
                      ":",
                      "else",
                      [
                        "block",
                        [
                          "if",
                          [
                            "==",
                            [
                              "extract",
                              "definitions",
                              0,
                            ],
                            "->",
                          ],
                          [
                            ":",
                            "then",
                            [
                              "block",
                              [
                                "slice",
                                "definitions",
                                2,
                                3,
                              ],
                            ],
                          ],
                          [
                            ":",
                            "else",
                            [
                              "quote",
                            ],
                          ],
                        ],
                      ],
                    ],
                  ],
                ],
              ],
              [
                "define",
                "identifier",
                [
                  "extract",
                  "identifier_list",
                  0,
                ],
              ],
              [
                "define",
                "params",
                [
                  "extract_parameters",
                  "identifier_list",
                ],
              ],
              [
                "define",
                "expressions",
                [
                  "block",
                  [
                    "if",
                    "is_equals",
                    [
                      ":",
                      "then",
                      [
                        "block",
                        [
                          "slice",
                          "first",
                          2,
                        ],
                      ],
                    ],
                    [
                      ":",
                      "else",
                      [
                        "block",
                        [
                          "slice",
                          "body",
                          1,
                        ],
                      ],
                    ],
                  ],
                ],
              ],
              [
                "quote",
                "define_function",
                [
                  "$",
                  "identifier",
                ],
                [
                  "$",
                  "params",
                ],
                [
                  "return_type",
                  [
                    "$@",
                    "return_type",
                  ],
                ],
                [
                  "$",
                  [
                    "concat",
                    [
                      "quote",
                      "block",
                    ],
                    "expressions",
                  ],
                ],
              ],
            ],
          ],
        ],
        [
          "define_function",
          "fib",
          [
            "parameters",
            [
              ":",
              "n",
              "i32",
            ],
          ],
          [
            "return_type",
            "i32",
          ],
          [
            "block",
            [
              "block",
              [
                "define",
                "base",
                1,
              ],
              [
                "if",
                [
                  "<=",
                  "n",
                  "base",
                ],
                [
                  ":",
                  "then",
                  [
                    "block",
                    "n",
                  ],
                ],
                [
                  ":",
                  "else",
                  [
                    "block",
                    [
                      "+",
                      [
                        "fib",
                        [
                          "-",
                          "n",
                          1,
                        ],
                      ],
                      [
                        "fib",
                        [
                          "-",
                          "n",
                          2,
                        ],
                      ],
                    ],
                  ],
                ],
              ],
            ],
          ],
        ],
      ],
    ],
  ],
]
`;

exports[`quote2 expands macros within macros 1`] = `
[
  "module",
  "root",
  [
    "exports",
    [
      "std#2384",
    ],
  ],
  [
    [
      "module",
      "std",
      [
        "exports",
        [],
      ],
      [
        [
          "use",
          [
            "::",
            "root",
            "all",
          ],
        ],
      ],
    ],
    [
      "module",
      "test",
      [
        "exports",
        [],
      ],
      [
        [
          "use",
          [
            "::",
            "root",
            "all",
          ],
        ],
        [
          "pub",
          "macro",
          [
            "\`",
          ],
          "quote2",
          [
            "$@",
            "body",
          ],
        ],
        [
          "pub",
          "macro",
          [
            "binaryen_gc_call",
            "func",
            "args",
            "return_type",
          ],
          [
            "block",
            [
              "\`",
              "binaryen",
              [
                ":",
                "func",
                [
                  "$",
                  "func",
                ],
              ],
              [
                ":",
                "namespace",
                "gc",
              ],
              [
                ":",
                "args",
                [
                  "$",
                  "args",
                ],
              ],
              [
                ":",
                "return_type",
                [
                  "$",
                  "return_type",
                ],
              ],
            ],
          ],
        ],
        [
          "pub",
          "macro",
          [
            "bin_type_to_heap_type",
            "type",
          ],
          [
            "block",
            [
              "binaryen_gc_call",
              "modBinaryenTypeToHeapType",
              [
                "\`",
                [
                  "array",
                  [
                    "BnrType",
                    [
                      "generics",
                      [
                        "$",
                        "type",
                      ],
                    ],
                  ],
                ],
              ],
            ],
          ],
        ],
        [
          "bin_type_to_heap_type",
          [
            "FixedArray",
            [
              "generics",
              "Int",
            ],
          ],
        ],
      ],
    ],
  ],
]
`;
